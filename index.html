<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>If The Data Will Not Come To The Astronomer...</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/talk_dark.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="if-the-data-will-not-come-to-the-astronomer">If The Data Will Not Come To The Astronomer...</h1><h2 id="adam-thornton">Adam Thornton</h2><h2 id="lsst">LSST</h2><p><a href="mailto:athornton@lsst.org">athornton@lsst.org</a></p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="overview">Overview</h1><h2 id="id1">LSST</h2><h2 id="astronomical-analysis-methodologies">Astronomical Analysis Methodologies</h2><h2 id="science-platform-and-interactive-notebook-environment">Science Platform and Interactive Notebook Environment</h2></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="lsst-overview">LSST Overview</h1><p>One more entertaining overview, one page of cool statistics, and a
thorough overview:</p><ul><li><a href="https://www.ted.com/talks/andrew_connolly_what_s_the_next_window_into_our_universe">Andy Connolly's LSST TED Talk</a>.</li><li><a href="https://confluence.lsstcorp.org/display/LKB/LSST+Key+Numbers">LSST Key Numbers</a>.</li><li><a href="https://arxiv.org/abs/0805.2366">LSST Overview Paper</a>.</li><li>The Large Synoptic Survey Telescope is funded by the National Science
Foundation and the Department of Energy, as well as a host of other
donors, public and private.</li></ul></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="lsst-science-goals">LSST Science Goals</h1><ul><li>LSST will perform a ten-year survey of the Southern sky: whole sky
every three nights at optical and infrared wavelengths.</li><li>Primary goal: detection of faint transient objects:<ul><li>Near-Earth Objects (NEOs)</li><li>Trans-Neptunian Objects (TNOs)</li><li>Type Ia Supernovae (SN1ae)</li></ul></li></ul></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="what-can-lsst-see">What Can LSST See?</h1><p>Single-visit detection to 24.7 magnitude, 10-year-stacked to 27.5 (red
band).  That's very faint.  How faint?</p><h2 id="depth">Depth</h2><p>Every five magnitudes is a factor of 100 in brightness.  You want tech
debt?</p><p>Your eyes: 6 magnitude.  Mmmmmaybe 8 under ideal conditions.  Ptolemy's
faintest stars are "of the sixth magnitude."</p><p>A good amateur scope: 14ish magnitude (eyes), around 20 with CCDs</p></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="id2">Depth</h1><h2 id="lsst-depth">LSST depth</h2><ul><li>Saturates at 16 magnitude</li><li>Single-visit (red) 24.7 magnitude</li><li>10-year stacked depth (red) 27.5 magnitude</li></ul><h2 id="not-the-deepest">Not the deepest</h2><ul><li>Hubble Space Telescope: 31.</li><li>James Webb Space Telescope: 34 magnitude (expected)</li></ul></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="field-of-view">Field of view</h1><p>Depth isn't everything</p><ul><li>Humongous: 9.62 degrees <sup>2</sup></li><li>40 full moons; roughly a CD held at arm's length.</li><li>JWST, by contrast, is 9.7 arcmin <sup>2</sup>, so roughly 1/3600 of LSST.</li></ul><img src="images/fov.png" height="400px"></img></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="camera">Camera</h1><ul><li>Focal plane array: 3.2 Gpixels</li><li>189 4K x 4K sensors</li><li>18 bits per pixel</li><li>Each exposure 15 seconds</li><li>Two exposures per visit (to do cosmic-ray/atmospheric transient
rejection).</li></ul><img src="images/camera.png" height="400px"></img></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="lsst-mirror-design"><a href="https://www.lsst.org/about/tel-site/mirror">LSST Mirror Design</a></h1><ul><li><dl><dt>8.4m, but that combines primary and tertiary</dt><dd><ul><li>Effective collection area equivalent to 5.6m mirror</li></ul></dd></dl></li><li>Not the largest primary telescope mirror, but...</li><li>The primary/tertiary mirror is the largest monolithic piece of glass
ever fabricated</li></ul><img src="images/mirror.gif" height="400px"></img></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="data-collection">Data Collection</h1><ul><li>On the order of 20 TB a night (100x SDSS)</li><li>Half an exabyte in the final image collection by operational EOL (DR11)</li><li>Largest non-proprietary data set, period.</li><li>Over one trillion photometric measures of celestial sources</li></ul></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="observations-of-celestial-objects">Observations of Celestial Objects</h1><ul><li>10-40 million AGNs (quasars)</li><li>300,000 supernovae a year<ul><li>Current detection rate is about 7,000 supernovae per year.  That's a
fortyfold increase from current detection capabilities, from a
single instrument.</li><li>A supernova explodes in a Milky-Way-scale galaxy once every few
hundred years.</li><li>One goes off somewhere in the observable universe roughly every ten
seconds.</li></ul></li><li>Roughly 20 billion galaxies</li><li>Roughly 20 billion stars</li></ul></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><div class="line-block"><br></br></div></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="astronomical-research-status-quo">Astronomical Research Status Quo</h1><p>Typically, astronomical research has been done with:</p><ul><li><dl><dt>Desktop or laptop computer</dt><dd><ul><li>Usually pretty beefy by the standards of the day</li></ul></dd></dl></li><li><dl><dt>Astronomical software</dt><dd><ul><li>Usually written by the researcher to address a particular
hypothesis.</li><li>Usually written by a single astronomer, rather than a
team of software engineers.</li><li>Maybe written by many astronomers, which is arguably worse.</li></ul></dd></dl></li><li>Downloaded data stored locally</li></ul></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="obvious-failure-modes">Obvious Failure Modes</h1><h2 id="personal-or-departmental-machines">Personal or Departmental Machines</h2><ul><li>A pretty beefy computer from ten years ago is today's worthless
paperweight.</li><li>Laptops get stolen a lot.</li><li>Individuals often are not careful about backing up data.</li><li>Academic departments care about research in their fields, not about IT
practices.<blockquote><ul><li>Your departmental system administrator is almost certainly a
graduate student doing it on the side.</li><li>You don't have the budget for offsite backups and decent DR.</li></ul></blockquote></li></ul></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="id4">Obvious Failure Modes</h1><h2 id="analysis-software">Analysis Software</h2><ul><li>If individually-written, usually reinvents many wheels, and only
answers one question.</li><li>General-purpose in-house analysis stacks are often extremely complex
and difficult to install.<blockquote><ul><li>LSST stack's heritage, and a fair bit of the implementation, goes
back to SDSS (began collecting data in 2000; obviously the
software had been in development long before then).</li><li>An installation of the LSST stack from scratch takes hours for
experienced users.</li><li>Taking weeks to install the first time is not unusual (also
consuming experienced users' time).</li><li>I myself have never successfully managed a source install from
scratch.</li></ul></blockquote></li></ul></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="id5">Obvious Failure Modes</h1><h2 id="scale-of-the-data">Scale of the Data</h2><p>Are you really going to download half an exabyte?</p><ul><li>The input is 40 Gbps all night each night for 10 years.  How long
is it going to take you to slurp it back out of the data center?</li></ul><p>"Big Data is data you cannot pick up."</p><ul><li>Is half an exabyte still going to be Big Data in 2032?</li><li>I wouldn't bet <em>against</em> it.</li></ul></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="data-access">Data Access</h1><p>Traditionally, you jealously guard your data so that you can publish
first and not get scooped.</p><ul><li>This works fine for small collaborations and projects.</li><li>LSST, on the other hand, has thousands of researchers with data
rights.</li><li>And anyway there's so much data that access to the analysis is going
to be much more valuable than access to the data.<blockquote><ul><li>Not everyone gets this, yet.</li></ul></blockquote></li></ul></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="data-rights">Data Rights</h1><p>LSST has a fairly complicated data rights scheme...</p><ul><li>Which turns out to be very broad.  Like, everyone affiliated with a US
or Chilean institution, plus anyone affiliated with a member
institution...</li><li>So maybe 10,000 out of 20,000 professional astronomers or advanced
students...</li><li>Any of whom can invite someone to collaborate with them on a paper...</li><li><dl><dt>So except for the two people who don't have any friends...</dt><dd><ul><li>They're theorists anyway.</li></ul></dd></dl></li></ul></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="data-scale">Data Scale</h1><ul><li>Almost all of this data will never be directly examined by a human.</li><li>Most of the images do not contain anything very novel.</li><li>We still expect to find, on average, one detector-saturating SN1a <em>per
night</em>.  A million well-characterized SN1e over the survey life.</li><li>Being stingy with the data is pretty self-defeating.</li><li>An interesting parallel to how particle physics evolved into a Big
Data/Big Collaboration/Big Science field can be found in <a href="http://www.hup.harvard.edu/catalog.php?isbn=9780674019966">Giant
Telescopes</a>.</li></ul></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="a-different-way-to-do-astronomy">A Different Way To Do Astronomy</h1><ul><li>Making your own private copy of the data set has become infeasible.</li><li>The analysis, not the data, is the professionally-valuable part.</li><li><dl><dt>How do we facilitate rapid iteration of analysis?</dt><dd><ul><li>Quickly try a lot of hypotheses and discard the unpromising ones.</li><li>Once you have one you like, turn it loose on a lot of data.</li></ul></dd></dl></li></ul></div><div class="step step-level-1" step="20" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="32000" data-y="0" data-z="0"><h1 id="interactive-vs-batch">Interactive vs. Batch</h1><p>We expect that a researcher will use the "interactive notebook aspect of
the LSST Science Platform" (by which we mean JupyterLab, or perhaps its
successors) to perform this iteration.  Effectively, we make the
interactive environment a rapid prototyping tool.  It has the following
characteristics:</p><ul><li>Relatively tiny subset of the data: a few terabytes, probably less.</li><li>The <em>real</em> analysis will be submitted to a batch system to work on
petabyte-scale data.</li></ul><p>What does this imply?</p><ul><li>It's not really about speed of data access or computation.</li><li>Access to completely arbitrary subsets of the data, however, is
<em>absolutely crucial</em>.</li></ul></div><div class="step step-level-1" step="21" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="33600" data-y="0" data-z="0"><h1 id="community-acceptance">Community Acceptance</h1><p>The trickiest design goal is that we cannot make any researcher's life
significantly worse.</p><p>Obviously the current system isn't ideal:</p><ul><li>Large, complex, bespoke analysis stack.</li><li>Hugely complicated installation and configuration.</li><li>Enormous amounts of technical debt.</li></ul><p>But...it also gets the job done.</p><p>We have to please a bunch of stakeholders.</p></div><div class="step step-level-1" step="22" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="35200" data-y="0" data-z="0"><h1 id="community-of-stakeholders">Community of Stakeholders</h1><h2 id="developers-of-the-analysis-pipeline">Developers of the Analysis Pipeline</h2><p>The LSST stack is big.  No one works on the whole thing.  The way it's
developed is that someone takes a version (either a release version,
approximately every 6 months, or a weekly build) and works on their own
little corner of it in a conda or pip environment.  We must support
that.</p></div><div class="step step-level-1" step="23" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="36800" data-y="0" data-z="0"><h1 id="id6">Community of Stakeholders</h1><h2 id="people-concerned-with-data-rights">People Concerned With Data Rights</h2><p>We <em>do</em> have to care who gets to see what, since the current belief in
the astronomical community is that big discoveries will be made quickly.
Since access is institutional or national, it's not quite as horrible as
it could be.</p></div><div class="step step-level-1" step="24" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="38400" data-y="0" data-z="0"><h1 id="id7">Community of Stakeholders</h1><h2 id="education-and-public-outreach">Education and Public Outreach</h2><p>Here's where Data Rights gets particularly thorny.  You need to have
adequate data available to put together meaningful educational curricula
and enable citizen science, but not so much, or of such fidelity, that
someone without data rights can scoop a researcher with data rights.</p><p>It is not entirely clear to me that this is possible.</p></div><div class="step step-level-1" step="25" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="40000" data-y="0" data-z="0"><h1 id="id8">Community of Stakeholders</h1><h2 id="established-astronomers">Established Astronomers</h2><p>Kids these days with their fancy-pants Jupyter notebooks and their HDF5
data representations, but dangit FORTRAN IV and FITS were good enough
for my grandpappy an' they're good enough for me!  GET OFFA MY LAWN!</p><p>In practice: you need a Terminal window that gives you shell access to
something that looks like a Unix system.  We mimic a system on which you
have an unprivileged account, which is very familiar to academic users.</p></div><div class="step step-level-1" step="26" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="41600" data-y="0" data-z="0"><h1 id="id9">Community of Stakeholders</h1><h2 id="security-and-more-generally-operations">Security (and more generally Operations)</h2><p>We understand how to create virtual machines and set them up as
multi-user systems.  But you want an ephemeral container?  That has
write access to certain filesystems?  That isn't going to be around long
enough to go through our Qualys scan and patching procedure?  That needs
to be available so quickly we can't even set it up with Puppet?  Are you
insane?</p><p>If we make it look like an existing multi-user system, with write access
to home directories and scratch space, but not the OS, and we show that
we can completely characterize what is in the container, this is a much
easier sell.</p></div><div class="step step-level-1" step="27" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="43200" data-y="0" data-z="0"><div class="line-block"><br></br></div></div><div class="step step-level-1" step="28" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="44800" data-y="0" data-z="0"><h1 id="what-do-we-want">What Do We Want?</h1><p>Let's imagine a better world:</p><ul><li>You don't need to spend hours-to-weeks setting up the software
environment.</li><li>In fact, all that's needed for analysis is a web browser.  Compute and
data storage happen somewhere else.</li><li>You have a single login to manage your access to the environment.</li><li>You don't need to pick a data subset that will fit on your laptop or
your desktop NAS.</li><li>The analysis is running on professionally-maintained machines in a
real datacenter somewhere that it isn't your problem.</li></ul></div><div class="step step-level-1" step="29" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="46400" data-y="0" data-z="0"><h1 id="let-s-think-bigger">Let's Think Bigger</h1><ul><li>Logging and metrics are aggregated, centralized, and reported on an
operations dashboard.</li><li>The analysis environment supports a publication paradigm that enables
verification and reproducability of results.</li><li>The analysis environment is amenable to a bring-your-own-data
approach.</li><li>There's a standardized, modular infrastructure, allowing
piece-by-piece component replacement of your application stack.</li></ul></div><div class="step step-level-1" step="30" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="48000" data-y="0" data-z="0"><h1 id="the-big-reveal">The Big Reveal</h1><p>(Not actually a surprise to anyone at this conference.)</p><h2 id="jupyterhub-jupyterlab-kubernetes">JupyterHub + JupyterLab + Kubernetes</h2><ul><li>JupyterLab: the UX is much better than the classic notebook.
Multiple panes within a single browser tab, including terminal
sessions, is a tremendous feature, giving users basically an IDE.</li><li>JupyterHub: the obvious choice for access control and resource
allocation brokering.  Authenticator and Spawner subclasses let us
do some really nifty things, which you will see.</li><li>Kubernetes: it clearly won.  Google, Amazon, and Azure all offer
managed Kubernetes infrastructure.</li></ul></div><div class="step step-level-1" step="31" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="49600" data-y="0" data-z="0"><h1 id="abstraction-and-layering">Abstraction and Layering</h1><ul><li>Virtualization lets you stop caring about the specifics of your
hardware.</li><li>Containerization lets you stop caring about managing the
OS/distribution layer.</li><li>Kubernetes gives you a standardized way to talk about container
orchestration and lets you stop caring how your containers talk to
each other or how the container network talks to the outside world and
vice versa.</li></ul></div><div class="step step-level-1" step="32" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="51200" data-y="0" data-z="0"><h1 id="specifying-resources">Specifying Resources</h1><p>You can say, "I need a kubernetes cluster that..."</p><ul><li>has at least 3 nodes, but also at least 0.5 cores per concurrent user;
each core with at least 2GB of RAM.</li><li>has individual nodes with at least 8 cores / 16GB RAM.</li><li>has a predefined ingress controller.</li><li>has three service accounts:<blockquote><ul><li>default privileges for one</li><li>create/destroy/describe/list pods for the second</li><li>the same, plus cluster-wide reads, for the third</li><li>("or just give me a cluster admin account and I'll take care of
it.")</li></ul></blockquote></li></ul></div><div class="step step-level-1" step="33" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="52800" data-y="0" data-z="0"><h1 id="scaling">Scaling</h1><p>Step one: Add more nodes to your cluster.  (Or take some away.)</p><ul><li>In a public cloud, this is really, really easy.  Perhaps even
automated.</li></ul><p>Step two: Change the replica counts in your deployments.</p><ul><li>You can turn this into a closed-loop automated system by monitoring
your load too.</li></ul><p>There is no step three.</p></div><div class="step step-level-1" step="34" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="54400" data-y="0" data-z="0"><h1 id="the-long-bet">The Long Bet</h1><p>Kubernetes will save astronomy.</p><ul><li>It's the first time we've had a functional abstraction layer that
allows you to specify scalable architectural designs.</li><li>This lets you create complex multicomponent applications that will run
on any suitable cluster, with built-in lifecycle management.</li><li>And because it's modular, you can use best-practice patterns for all
the infrastructure and only <em>really</em> care about managing the analysis
stack that is your actual application.</li></ul></div><div class="step step-level-1" step="35" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="56000" data-y="0" data-z="0"><h1 id="modularity">Modularity</h1><ul><li>Delineate plumbing from application.</li><li>Provide a clear way to replace the value-added part (for us: the LSST
Science Pipeline) with your own payload.</li><li>Retain the robust infrastructure with component lifecycle management
and automated resource allocation.</li></ul><p>This lets you both have your cake and eat it.  You get to use whatever
insanely complex analysis framework you want wrapped inside a
general-purpose, self-healing application architecture.</p></div><div class="step step-level-1" step="36" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="57600" data-y="0" data-z="0"><h1 id="id10">Modularity</h1><p>Replacing the payload is a matter of replacing the JupyterLab container
that is spawned for the user.</p><p>Assuming you have the analysis pipeline already, what you need is
conceptually quite simple, and the implementation is not hard.</p><ul><li>A container that will start a JupyterLab server.</li><li>Some way to wrap your analysis pipeline up as a Jupyter kernel.<blockquote><ul><li>Which, assuming it's in a supported language, is probably <a href="https://github.com/lsst-sqre/jupyterlabdemo/blob/master/jupyterlab/lsstlaunch.bash">a few
lines of shell</a>.</li></ul></blockquote></li></ul><p>I would be flabbergasted if this approach were not portable to other
physical sciences and very possibly to other (and very general) analytic
problem spaces.</p></div><div class="step step-level-1" step="37" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="59200" data-y="0" data-z="0"><div class="line-block"><br></br></div></div><div class="step step-level-1" step="38" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="60800" data-y="0" data-z="0"><h1 id="lsst-jupyterlab-implementation">LSST JupyterLab Implementation</h1><h2 id="id11">Overview</h2><p><a href="https://sqr-018.lsst.io/">SQR-018</a> describes the architecture.</p><p>The complete implementation is available at <a href="https://github.com/lsst-sqre/jupyterlabdemo">GitHub</a>.</p><img src="images/jupyterlab_sp.png" height="400px"></img></div><div class="step step-level-1" step="39" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="62400" data-y="0" data-z="0"><h1 id="deployment">Deployment</h1><p>We have an automated tool for GKE plus DNS at Route53 to deploy.</p><ul><li>Makes it very easy to stand up a new cluster for tutorials or
meetings.</li><li>Can also generate configuration YAML from templates plus environment
variables, or from a supplied configuration file.  The YAML can
then be hand-tweaked for, e.g., on-premises deployment at the
LSST Data Facility.</li></ul></div><div class="step step-level-1" step="40" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="64000" data-y="0" data-z="0"><h1 id="id12">Deployment</h1><p>While our <a href="https://github.com/lsst-sqre/jupyterlabdemo">GitHub</a> implementation is very nifty, and useful for
reference...don't use it.</p><p>Use <a href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s/">Zero To JupyterHub</a> instead.</p><p>Some day we will probably migrate our deployment to Helm.  LSST EPO
already has.</p><ul><li>Not convinced Helm is the future.</li><li>We need something like Helm but with sequencing as well.  Templates
are the easy part.</li></ul></div><div class="step step-level-1" step="41" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="65600" data-y="0" data-z="0"><h1 id="problem-1-authentication">Problem 1: Authentication</h1><p>Authentication is annoying and hard.  Let's outsource it.</p><ul><li>OAuth2 is a thing, and JupyterHub supports it well.</li><li>Our current setup lets us use either GitHub or CILogon with the NCSA
ID provider (adding other providers and sources is straightforward).</li><li>You do need a public endpoint with a verifiable TLS certificate to do
the OAuth callback.</li><li>However, this is still way too open</li></ul><p><a href="images/screenshots/cilogon.png">[login_screenshot]</a></p></div><div class="step step-level-1" step="42" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="67200" data-y="0" data-z="0"><h1 id="problem-2-authorization">Problem 2: Authorization</h1><p>How do we restrict beyond "has a GitHub/NCSA account"?</p><p>Both have concepts of group memberships.</p><ul><li>OAuth2 scopes allow us to attach capabilities to tokens; for instance,
"enumerate a user's groups."  That's what you need to determine if you
are in the LSST group.</li><li>Subclass the <a href="https://github.com/lsst-sqre/jupyterlabdemo/blob/master/jupyterhub/sample_configs/github/10-authenticator.py">OAuth2 authenticator</a> in <tt>jupyterhub_config.py</tt>.</li></ul><p><a href="images/screenshots/denylist.png">[auth_screenshot]</a></p></div><div class="step step-level-1" step="43" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="68800" data-y="0" data-z="0"><h1 id="problem-3-global-user-consistency">Problem 3: Global User Consistency</h1><p>GitHub's user account ID fits into a 32-bit value.  Each GitHub
Organization also has an ID.  There are our UID/GID maps.</p><p>CILogon does something similar.</p><p>Now you have globally consistent users and groups.</p><p><a href="images/screenshots/uid-gids.png">[uid_screenshot]</a></p></div><div class="step step-level-1" step="44" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="70400" data-y="0" data-z="0"><h1 id="problem-4-restricting-user-access">Problem 4: Restricting User Access</h1><p>We control the environment in the newly-created Lab container.</p><p>We use that to provision a user with the right UID+GIDs set.</p><p>Then we become that user before starting the JupyterLab server.</p><p><a href="images/screenshots/processes.png">[proc_screenshot]</a></p></div><div class="step step-level-1" step="45" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="72000" data-y="0" data-z="0"><h1 id="problem-5-persistent-storage">Problem 5: Persistent Storage</h1><p>We have globally unique UIDs and GIDs.</p><ul><li>We mount <tt>/home</tt> and whatever other filesystems we want.</li><li>Data access and sharing immediately collapses to the long-solved
problem of Unix filesystem access.</li><li>We use NFS, because it's easy.<blockquote><ul><li>We provision the space and volumes in the cloud.</li><li>We point to an external NFS server at our LDF.</li></ul></blockquote></li><li>We could eventually be cleverer, but we're still going to make it look
like a POSIX filesystem to our users.</li></ul><p><a href="images/screenshots/filesystem.png">[filesystem_screenshot]</a></p></div><div class="step step-level-1" step="46" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="73600" data-y="0" data-z="0"><h1 id="problem-6-user-access-restriction">Problem 6: User Access Restriction</h1><p>Don't give your users <tt>sudo</tt>.  Heck, don't even give them passwords.</p><p>Globally-consistent UID and GIDs.</p><p>You're done.</p><p>Users can still override bits of the stack with <tt>pip install --user</tt>.</p><ul><li>Put something on the options form that lets the user clear
<tt>$HOME/.local</tt>.  Trust me on this.</li></ul><p><a href="images/screenshots/nosudo.png">[sudo_screenshot]</a></p></div><div class="step step-level-1" step="47" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="75200" data-y="0" data-z="0"><h1 id="problem-7-auditability-and-maintainability">Problem 7: Auditability and Maintainability</h1><p>It's a container.  You know how you built it (at least if you use
particular package versions, not <tt>latest</tt>).  It's repeatable and
immutable.</p><p>We look for regressions in the stack by creating an <a href="https://github.com/lsst-sqre/jupyterlabdemo/blob/master/jupyterhub/sample_configs/github/20-spawner.py">options form</a> that
scans our repository and presents a menu of recent builds.</p><p><a href="images/screenshots/options.png">[options_screenshot]</a></p></div><div class="step step-level-1" step="48" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="76800" data-y="0" data-z="0"><h1 id="problem-8-startup-time-and-user-frustration">Problem 8: Startup Time and User Frustration</h1><p>Our images are huge and take on the order of 15 minutes to pull.</p><ul><li>"So don't do that."</li><li>Unless your analysis stack is inherently gargantuan...</li><li>...so we pre-pull them.</li></ul><p>Within, say, an hour and a half of building (which is usually in the
middle of the night) each image is available on each node and therefore
starts quickly.</p><p><a href="images/screenshots/prepuller.png">[prepuller_screenshot]</a></p></div><div class="step step-level-1" step="49" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="78400" data-y="0" data-z="0"><h1 id="resources">Resources</h1><ul><li><a href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s/">Zero To JupyterHub</a>.</li><li><a href="https://gitter.im/jupyterlab/jupyterlab">JupyterLab (and Hub) Gitter</a>.</li><li><a href="https://github.com/lsst-sqre/jupyterlabdemo">LSST JupyterLab Implementation</a>.</li></ul></div><div class="step step-level-1" step="50" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="80000" data-y="0" data-z="0"><h1 id="live-demo">Live Demo</h1></div><div class="step step-level-1" step="51" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="81600" data-y="0" data-z="0"><h1 id="questions">Questions</h1></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>