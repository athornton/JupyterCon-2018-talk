<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>If The Data Will Not Come To The Astronomer...</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/talk_dark.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="if-the-data-will-not-come-to-the-astronomer">If The Data Will Not Come To The Astronomer...</h1><h2 id="adam-thornton">Adam Thornton</h2><h2 id="lsst">LSST</h2><p><a href="mailto:athornton@lsst.org">athornton@lsst.org</a></p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="overview">Overview</h1><h2 id="id1">LSST</h2><h2 id="astronomical-analysis-methodologies">Astronomical Analysis Methodologies</h2><h2 id="science-platform-and-interactive-notebook-environment">Science Platform and Interactive Notebook Environment</h2></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="lsst-overview">LSST Overview</h1><p>One more entertaining overview, one page of cool statistics, and a
thorough overview:</p><ul><li><a href="https://www.ted.com/talks/andrew_connolly_what_s_the_next_window_into_our_universe">Andy Connolly's LSST TED Talk</a>.</li><li><a href="https://confluence.lsstcorp.org/display/LKB/LSST+Key+Numbers">LSST Key Numbers</a>.</li><li><a href="https://arxiv.org/abs/0805.2366">LSST Overview Paper</a>.</li><li>The Large Synoptic Survey Telescope is funded by the National Science
Foundation and the Department of Energy, as well as a host of other
generous donors, public and private.</li></ul></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="lsst-science-goals">LSST Science Goals</h1><ul><li>LSST will perform a ten-year survey of the Southern sky: whole sky
every three nights at optical and infrared wavelengths.</li><li>Primary goal: detection of faint objects that change between visits:<ul><li>Comprehensive solar system survey.<ul><li>NEOs (&gt; 90% 140m objects by 2040).</li><li>Trans-Neptunian Objects (TNOs).</li></ul></li><li>Milky Way structure and stellar content.</li><li>Transient phenomena at optical wavelengths.<ul><li>AGNs, SN1ae, neutron star/black hole mergers ...</li></ul></li><li>Dark Energy and Dark Matter.<ul><li>Only 4 percent of the mass and energy in the universe is baryonic.</li><li>Is the Hubble Constant the same in every direction?</li></ul></li></ul></li></ul></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="magnitude">Magnitude</h1><p>LSST Single-visit detection to 24.7 magnitude, 10-year-stacked to 27.5
(red band).  That's very faint.  How faint?</p><ul><li>Tech debt: magnitude goes back to Hipparchus (150 BCE).</li></ul><blockquote><ul><li>Ptolemy's catalogue survives (150 CE): first through sixth
magnitude.  (Still a good estimate for naked-eye; ideal conditions
and very good eyes, maybe 8th.)</li><li>Pogson in 1856: 5 magnitudes is a factor of 100 in light flux.</li></ul></blockquote><p>A good amateur scope: 14ish magnitude looking through an eyepiece,
around 20 with CCDs.</p></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="depth">Depth</h1><h2 id="lsst-depth">LSST depth</h2><ul><li>Saturates at 16 magnitude.</li><li>Single-visit (red) 24.7 magnitude.</li><li>10-year stacked depth (red) 27.5 magnitude.</li><li>30/400 million times fainter than naked-eye.</li></ul><h2 id="not-the-deepest">Not the deepest</h2><ul><li>Hubble Space Telescope: 31.</li><li>James Webb Space Telescope: 34 magnitude (expected)</li></ul></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="field-of-view">Field of view</h1><p>Depth isn't everything</p><ul><li>Humongous: 9.62 degrees <sup>2</sup>.</li><li>40 full moons; roughly a CD held at arm's length.</li><li>JWST, by contrast, is 9.7 arcmin <sup>2</sup>, so roughly 1/3600 of LSST.</li></ul><img src="images/fov.png" height="400px"></img></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="camera">Camera</h1><ul><li>Focal plane array: 3.2 Gpixels.<ul><li>Nadine Kurita, former Project Manager for Camera, for scale.</li></ul></li><li>189 4K x 4K sensors (roughly 400 4K monitors).</li><li>18 bits per pixel.</li><li>Each exposure 15 seconds.</li><li>Two exposures per visit (to do cosmic-ray/atmospheric transient
rejection--and a bit of science).</li></ul><img src="images/camera.png" height="400px"></img></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="lsst-mirror-design"><a href="https://www.lsst.org/about/tel-site/mirror">LSST Mirror Design</a></h1><ul><li><dl><dt>8.4m, but that combines primary and tertiary.</dt><dd><ul><li>Effective collection area equivalent to 5.6m mirror.</li></ul></dd></dl></li><li>Not the largest primary telescope mirror, but...</li><li>The primary/tertiary mirror is the largest monolithic piece of glass
ever fabricated.</li></ul><img src="images/mirror.gif" height="400px"></img></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="cost">Cost</h1><ul><li>Telescope: about $500 million (all numbers in 2013 dollars).</li><li>Camera: about $165 million.</li><li>Operations:<ul><li>A little more than a dollar a second.</li><li>On the order of $100,000 a day.</li><li>Roughly $35 million a year.</li></ul></li></ul></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="data-collection">Data Collection</h1><ul><li>On the order of 20 TB a night (entire SDSS DR7 every three nights).</li><li>Half an exabyte in the final image collection (DR11).</li><li>Over one trillion photometric measures of celestial sources.</li><li>Reduced catalogue (which most people will use):<ul><li>Smaller than image collection: order of 15 PB.</li><li>Tens of billions of (complex-structured) rows in a database.</li></ul></li></ul></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="observations-of-celestial-objects">Observations of Celestial Objects</h1><ul><li>10-40 million AGNs (quasars).</li><li>300,000 supernovae a year.<ul><li>Current detection rate is about 7,000 supernovae per year.  That's a
fortyfold increase from current detection capabilities, from a
single instrument.</li><li>A supernova explodes in a Milky-Way-scale galaxy once every few
hundred years.</li><li>One goes off somewhere in the observable universe roughly every ten
seconds.</li></ul></li><li>Roughly 20 billion galaxies.</li><li>Roughly 20 billion stars.<ul><li>So everyone could have about three of each.</li></ul></li></ul></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><div class="line-block"><br></br></div></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="astronomical-research-status-quo">Astronomical Research Status Quo</h1><p>Historically, astronomical research has been done with:</p><ul><li><dl><dt>Desktop or laptop computer:</dt><dd><ul><li>Usually pretty beefy by the standards of the day.</li></ul></dd></dl></li><li><dl><dt>Astronomical software:</dt><dd><ul><li>Usually written by the researcher to address a particular
hypothesis.</li><li>Usually written by a single astronomer, rather than a
team of software engineers.</li><li>Maybe written by many astronomers, which is arguably worse.</li></ul></dd></dl></li><li>Downloaded data stored locally.</li></ul></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="obvious-failure-modes">Obvious Failure Modes</h1><ul><li>Local machine: age, security, IT practices.</li><li>Software: applicability, software engineering.</li><li>Data: scale, IT practices.</li></ul></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="data">Data</h1><ul><li>Access: too much for traditional hoarding model.</li><li>Rights: already very broad, and gameable to some degree.</li><li>Scale: most will never be directly examined by a human.</li></ul></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="a-different-way-to-do-astronomy">A Different Way To Do Astronomy</h1><ul><li>Making your own private copy of the data set becomes infeasible.</li><li>The analysis, not the data, is the professionally-valuable part.</li><li>How do we facilitate rapid iteration of analysis?<ul><li>Quickly try a lot of hypotheses and discard unpromising ones.</li><li>Once you have one you like, turn it loose on a lot of data.</li></ul></li></ul></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="interactive-vs-batch">Interactive vs. Batch</h1><p>We expect that a researcher will use the "interactive notebook aspect of
the LSST Science Platform" (by which we mean JupyterLab, or perhaps its
successors) to perform this iteration.  It is a rapid prototyping tool
with the following characteristics:</p><ul><li>Relatively tiny subset of the data: a few terabytes, probably less.</li><li>The <em>real</em> analysis will be submitted to a batch system to work on
petabyte-scale data.</li><li>We don't know what subset we want in advance.</li></ul></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="what-does-this-imply">What does this imply?</h1><ul><li>It's not really about speed of data access or computation.</li><li>Access to completely arbitrary subsets of the data, however, is
<em>absolutely crucial</em>.</li><li>Bring your code to the data, not the other way around.</li></ul></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="community-acceptance">Community Acceptance</h1><p>The trickiest design goal is that we cannot make any user's life
significantly worse than the status quo.</p><p>Obviously the current system isn't ideal:</p><ul><li>Large, complex, bespoke analysis stack.</li><li>Hugely complicated installation and configuration.</li><li>Enormous amounts of technical debt.</li></ul><p>But...it also gets the job done.  The analysis software encodes
literally hundreds, perhaps thousands, of astronomer-years of work on
difficult problems.  It is inherently complex.</p><p>We have to please a bunch of groups of users.</p></div><div class="step step-level-1" step="20" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="32000" data-y="0" data-z="0"><h1 id="community-of-users">Community of Users</h1><h2 id="developers-of-the-analysis-pipeline">Developers of the Analysis Pipeline</h2><p>The LSST stack is big.  No one works on the whole thing.  The way it's
developed is that someone takes a version (either a release version,
approximately every 6 months, or a weekly build) and works on their own
little corner of it in a conda or pip environment.  We must support
that.</p></div><div class="step step-level-1" step="21" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="33600" data-y="0" data-z="0"><h1 id="id3">Community of Users</h1><h2 id="established-astronomers">Established Astronomers</h2><p>Kids these days with their fancy-pants Jupyter notebooks and their HDF5
data representations, but dangit FORTRAN IV and FITS were good enough
for my grandpappy an' they're good enough for me!  GET OFFA MY LAWN!</p><p>In practice: you need a Terminal window that gives you shell access to
something that looks like a Unix system.  We mimic a system on which you
have an unprivileged account, which is very familiar to academic users.</p><p>There is something of an Uncanny Valley problem here.</p></div><div class="step step-level-1" step="22" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="35200" data-y="0" data-z="0"><h1 id="id4">Community of Users</h1><h2 id="security-and-more-generally-operational-support">Security (and more generally Operational Support)</h2><img src="images/Dumpsterfire.gif" height="300px"></img><p>It's a fair cop, but if if we make it look like an existing multi-user
system, where the user doesn't have <tt>root</tt> or <tt>sudo</tt> within the
container, and has write access only to <tt>${HOME}</tt> and scratch space
but not the OS, and furthermore we show that we can completely
characterize the container's contents, it's a much easier sell.</p></div><div class="step step-level-1" step="23" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="36800" data-y="0" data-z="0"><div class="line-block"><br></br></div></div><div class="step step-level-1" step="24" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="38400" data-y="0" data-z="0"><h1 id="what-do-we-want">What Do We Want?</h1><p>Let's imagine a better world:</p><ul><li>You don't need to spend hours-to-weeks setting up the software
environment.</li><li>In fact, all that's needed for analysis is a web browser.  Compute and
data storage happen somewhere else.</li><li>You have a single login to manage your access to the environment.</li><li>You don't need to pick a data subset that will fit on your laptop or
your desktop NAS.</li><li>The analysis is running on professionally-maintained machines in a
real datacenter somewhere that it isn't your problem.</li></ul></div><div class="step step-level-1" step="25" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="40000" data-y="0" data-z="0"><h1 id="let-s-think-bigger">Let's Think Bigger</h1><ul><li>Logging and metrics are aggregated, centralized, and reported on an
operations dashboard.</li><li>The analysis environment supports a publication paradigm that enables
verification and reproducability of results.</li><li>The analysis environment is amenable to a bring-your-own-data
approach.</li><li>There's a standardized, modular infrastructure, allowing
piece-by-piece component replacement of your application stack.</li></ul></div><div class="step step-level-1" step="26" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="41600" data-y="0" data-z="0"><h1 id="the-big-reveal">The Big Reveal</h1><p>(Not actually a surprise to anyone at this conference.)</p><h2 id="jupyterhub-jupyterlab-kubernetes">JupyterHub + JupyterLab + Kubernetes</h2><ul><li>JupyterLab: the UX is much better than the classic notebook.
Multiple panes within a single browser tab, including terminal
sessions, is a tremendous feature, giving users basically an IDE.</li><li>JupyterHub: the obvious choice for access control and resource
allocation brokering.  Authenticator and Spawner subclasses let us
do some really nifty things, which you will see.</li><li>Kubernetes: it clearly won.  Google, Amazon, and Azure all offer
managed Kubernetes infrastructure.</li></ul></div><div class="step step-level-1" step="27" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="43200" data-y="0" data-z="0"><h1 id="abstraction-and-layering">Abstraction and Layering</h1><ul><li>Virtualization lets you stop caring about the specifics of your
hardware.</li><li>Containerization lets you stop caring about managing the
OS/distribution layer.</li><li>Kubernetes lets you stop caring about managing the inter-component
networking of your application and container lifecycle management.</li></ul></div><div class="step step-level-1" step="28" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="44800" data-y="0" data-z="0"><h1 id="scaling">Scaling</h1><p>Step one: Add more nodes to your cluster.  (Or take some away.)</p><ul><li>In a public cloud, this is really, really easy.  Perhaps even
automated.</li></ul><p>Step two: Change the replica counts in your deployments.</p><ul><li>You can turn this into a closed-loop automated system by monitoring
your load too.</li></ul><p>There is no step three.</p></div><div class="step step-level-1" step="29" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="46400" data-y="0" data-z="0"><h1 id="the-long-bet">The Long Bet</h1><p>Kubernetes will save astronomy.</p><ul><li>It's the first time we've had a functional abstraction layer that
allows you to specify scalable architectural designs.</li><li>This lets you create complex multicomponent applications that will run
on any suitable cluster, with built-in lifecycle management.</li><li>And because it's modular, you can use best-practice patterns for all
the infrastructure and only <em>really</em> care about managing the analysis
stack that is your actual application.</li></ul></div><div class="step step-level-1" step="30" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="48000" data-y="0" data-z="0"><h1 id="modularity">Modularity</h1><ul><li>Separate plumbing from application.</li><li>Provide a clear way to replace the value-added part (for us: the LSST
Science Pipeline) with your own payload.</li><li>Retain the robust infrastructure with component lifecycle management
and automated resource allocation.</li></ul><p>This lets you both have your cake and eat it.  You get to use whatever
insanely complex analysis framework you want wrapped inside a
general-purpose, self-healing application architecture.</p></div><div class="step step-level-1" step="31" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="49600" data-y="0" data-z="0"><h1 id="id5">Modularity</h1><p>Replacing the payload is a matter of replacing the JupyterLab container
that is spawned for the user.</p><p>Assuming you have the analysis pipeline already, what you need is
conceptually quite simple, and the implementation is not hard.</p><ul><li>A container that will start a JupyterLab server.</li><li>Some way to wrap your analysis pipeline up as a Jupyter kernel.<ul><li>Which, assuming it's in a supported language, is probably <a href="https://github.com/lsst-sqre/jupyterlabdemo/blob/master/jupyterlab/lsstlaunch.bash">a few
lines of shell</a>.</li></ul></li></ul><p>I would be flabbergasted if this approach were not portable to other
physical sciences and very possibly to other (and very general) analytic
problem spaces.</p></div><div class="step step-level-1" step="32" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="51200" data-y="0" data-z="0"><h1 id="contributing">Contributing</h1><p>The Jupyter community is awesome.</p><p>JupyterLab is still changing fast:</p><ul><li>Sometimes underdocumented.</li><li>Documentation is not very discoverable.</li><li>Everyone is busy working on their own projects.</li><li>The best way to proceed is to implement something and then wait for
the gasps of horror from the people who <em>are</em> experts, then do what
they say.</li></ul></div><div class="step step-level-1" step="33" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="52800" data-y="0" data-z="0"><div class="line-block"><br></br></div></div><div class="step step-level-1" step="34" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="54400" data-y="0" data-z="0"><h1 id="lsst-jupyterlab-implementation">LSST JupyterLab Implementation</h1><h2 id="id6">Overview</h2><p><a href="https://sqr-018.lsst.io/">SQR-018</a> describes the architecture.</p><p>The complete implementation is available at <a href="https://github.com/lsst-sqre/jupyterlabdemo">GitHub</a>.</p><img src="images/jupyterlab_sp.png" height="400px"></img></div><div class="step step-level-1" step="35" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="56000" data-y="0" data-z="0"><h1 id="deployment">Deployment</h1><p>We have an automated tool for GKE plus DNS at Route53 to deploy.</p><ul><li>Makes it very easy to stand up a new cluster for tutorials or
meetings.</li><li>Can also generate configuration YAML from templates plus environment
variables, or from a supplied configuration file.  The YAML can
then be hand-tweaked for, e.g., on-premises deployment at the
LSST Data Facility.</li></ul></div><div class="step step-level-1" step="36" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="57600" data-y="0" data-z="0"><h1 id="id7">Deployment</h1><p>While our <a href="https://github.com/lsst-sqre/jupyterlabdemo">GitHub</a> implementation is very nifty, and useful for
reference...don't use it.</p><p>Use <a href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s/">Zero To JupyterHub</a> instead.  It uses Helm.</p><ul><li>Not convinced Helm is the future.</li><li>We need something like Helm but with sequencing as well.  Templates
are the easy part.</li><li>Terraform is intriguing.</li></ul></div><div class="step step-level-1" step="37" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="59200" data-y="0" data-z="0"><h1 id="problem-1-authentication">Problem 1: Authentication</h1><p>Authentication is annoying and hard.  Let's outsource it.</p><ul><li>OAuth2 is a thing, and JupyterHub supports it well.</li><li>Our current setup lets us use either GitHub or CILogon with the NCSA
ID provider (adding other providers and sources is straightforward).</li><li>You do need a public endpoint with a verifiable TLS certificate to do
the OAuth callback.</li><li>However, this is still way too open: we need authorization as well.</li></ul><p><a href="images/screenshots/cilogon.png">[login_screenshot]</a></p></div><div class="step step-level-1" step="38" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="60800" data-y="0" data-z="0"><h1 id="problem-2-authorization">Problem 2: Authorization</h1><p>How do we restrict beyond "has a GitHub/NCSA account"?</p><p>Both have concepts of group memberships.</p><ul><li>OAuth2 scopes allow us to attach capabilities to tokens; for instance,
"enumerate a user's groups."  That's what you need to determine if you
are in the LSST group.</li><li>Subclass the <a href="https://github.com/lsst-sqre/jupyterlabdemo/blob/master/jupyterhub/sample_configs/github/10-authenticator.py">OAuth2 authenticator</a> in <tt>jupyterhub_config.py</tt>.</li></ul><p><a href="images/screenshots/denylist.png">[auth_screenshot]</a></p></div><div class="step step-level-1" step="39" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="62400" data-y="0" data-z="0"><h1 id="problem-3-global-user-consistency">Problem 3: Global User Consistency</h1><p>GitHub's user account ID fits into a 32-bit value.  Each GitHub
Organization also has an ID.  There are our UID/GID maps.</p><p>CILogon + NCSA IDP does something similar.</p><p>Now you have globally consistent users and groups.</p><p><a href="images/screenshots/uid-gids.png">[uid_screenshot]</a></p></div><div class="step step-level-1" step="40" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="64000" data-y="0" data-z="0"><h1 id="problem-4-persistent-storage">Problem 4: Persistent Storage</h1><p>We have globally unique UIDs and GIDs.</p><ul><li>We mount <tt>/home</tt> and whatever other filesystems we want.</li><li>Data access and sharing immediately collapses to the long-solved
problem of Unix filesystem access.</li><li>We use NFS, because it's easy.<ul><li>We provision the space and volumes in the cloud, either in k8s or not.</li><li>We point to an external NFS server at our LDF.</li></ul></li><li>We could eventually be cleverer, but we're still going to make it look
like a POSIX filesystem to our users.</li></ul><p><a href="images/screenshots/filesystem.png">[filesystem_screenshot]</a></p></div><div class="step step-level-1" step="41" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="65600" data-y="0" data-z="0"><h1 id="problem-5-user-access-restriction">Problem 5: User Access Restriction</h1><p>Don't give your users <tt>sudo</tt>.  Don't even give them passwords.</p><p>You already have globally-consistent UID and GIDs.  Use root to
provision user with correct name/UID/GIDs as root at container startup.</p><p>Don't start the JupyterLab service as root; start it as the user instead.</p><p>You're done.</p><p>Users can still override bits of the stack with <tt>pip install --user</tt>.</p><ul><li>Put something on the options form that lets the user clear
<tt>$HOME/.local</tt>.  Trust me on this.</li></ul><p><a href="images/screenshots/nosudo.png">[sudo_screenshot]</a></p></div><div class="step step-level-1" step="42" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="67200" data-y="0" data-z="0"><h1 id="problem-6-auditability-and-maintainability">Problem 6: Auditability and Maintainability</h1><p>It's a container.  You know how you built it (at least if you use
particular package versions, not <tt>latest</tt>).  It's repeatable and
immutable.</p><p>We look for regressions in the stack by creating an <a href="https://github.com/lsst-sqre/jupyterlabdemo/blob/master/jupyterhub/sample_configs/github/20-spawner.py">options form</a> that
scans our repository and presents a menu of recent builds.  This also
allows users to choose their risk tolerance.</p><p><a href="images/screenshots/options.png">[options_screenshot]</a></p></div><div class="step step-level-1" step="43" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="68800" data-y="0" data-z="0"><h1 id="problem-7-startup-time-and-user-frustration">Problem 7: Startup Time and User Frustration</h1><p>Our images are huge and take on the order of 15 minutes to pull.</p><ul><li>"So don't do that."</li><li>Unless your analysis stack is inherently gargantuan...</li><li>...so we pre-pull them.</li></ul><p>Within, say, an hour and a half of building (which is usually in the
middle of the night) each image is available on each node and therefore
starts quickly.</p><p><a href="images/screenshots/prepuller.png">[prepuller_screenshot]</a></p></div><div class="step step-level-1" step="44" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="70400" data-y="0" data-z="0"><h1 id="resources">Resources</h1><ul><li><a href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s/">Zero To JupyterHub</a>.</li><li><a href="https://gitter.im/jupyterlab/jupyterlab">JupyterLab (and Hub) Gitter</a>.</li><li><a href="https://github.com/lsst-sqre/jupyterlabdemo">LSST JupyterLab Implementation</a>.</li></ul></div><div class="step step-level-1" step="45" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="72000" data-y="0" data-z="0"><h1 id="live-demo">Live Demo</h1></div><div class="step step-level-1" step="46" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="73600" data-y="0" data-z="0"><h1 id="questions">Questions</h1></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>